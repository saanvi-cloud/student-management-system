<div class="p-10">
  <!-- Content -->
  <div class="w-full flex">
    <div class="text-blue-700/80 font-bold text-3xl flex">
      <i class="fa-solid fa-book mr-2"></i>
      <h1>Course Management</h1>
    </div>
    <button
      class="text-white bg-blue-600 ml-auto border border-slate-300 rounded-md p-3 cursor-pointer"
      [routerLink]="['/courses/add']"
    >
      <i class="fa-solid fa-plus"></i>
      Add Course
    </button>
  </div>
  <hr class="w-full text-slate-300 shadow-md border-[0.5px] my-6">
  <table class="w-full my-10">
    <thead class="table-header">
      <th class="table-cell">Course Code</th>
      <th class="table-cell">Course Name</th>
      <th class="table-cell">Instructor</th>
      <th class="table-cell">Student Enrolled</th>
      <th class="table-cell">Schedule</th>
      <th class="table-cell">Actions</th>
    </thead>

    <tbody *ngIf="courses$ | async as courses; else loading">

      <ng-container *ngFor="let c of courses">

        <!-- MAIN ROW -->
        <tr class="border-b border-slate-300">
          <td class="py-4 pl-8">{{ c.course_id }}</td>
          <td class="py-4 pl-12">{{ c.course_name }}</td>
          <td class="py-4 pl-8">{{ c.instructor }}</td>
          <td class="py-4 pl-14">{{ c.students_enrolled }}</td>
          <td class="py-4 pl-8">{{ c.schedule }}</td>
          <td class="flex items-center justify-center gap-2 px-4 py-4">
            <button
              class="bg-cyan-500/80 w-[80px] p-2 text-white border rounded-md"
              (click)="toggleView(c.course_id)"
            >
              <i class="fa-solid fa-eye"></i> View
            </button>
            <button class="bg-orange-400 w-[80px] p-2 text-white border rounded-md btn btn-warning"
              [routerLink]="['/courses/edit', c.course_id]">
              <i class="fa-solid fa-pen-to-square"></i>
              Edit
            </button>
            <button
                class="bg-red-600/80 w-[90px] p-2 text-white rounded-md"
                (click)="deleteCourse(c.course_id)">
                <i class="fa-solid fa-trash"></i> Delete
            </button>
          </td>
        </tr>

        <!-- EXPANDED ROW -->
        <tr *ngIf="isExpanded(c.course_id)">
          <td colspan="6" class="bg-slate-100 px-8 py-6">
            <table class="w-full text-sm">
              <thead>
                <tr class="font-semibold">
                  <th>ID</th>
                  <th>Name</th>
                  <th>Grade</th>
                  <th>Attendance %</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let s of courseStudents[c.course_id]">
                  <td>{{ s.student_id }}</td>
                  <td>{{ s.student_name }}</td>
                  <td>{{ s.grade_numeric ?? '-' }}</td>
                  <td>{{ s.attendance_rate ?? '0' }}%</td>
                </tr>
              </tbody>
            </table>
          </td>
        </tr>

      </ng-container>

    </tbody>

  </table>
</div>
<ng-template #loading>
  <tr>
    <td colspan="6" class="text-center text-slate-500 py-10">
      Loading courses...
    </td>
  </tr>
</ng-template>
