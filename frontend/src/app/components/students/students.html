<div class="p-10">
  <!-- Header -->
  <div class="w-full flex justify-between">
    <div class="text-blue-700/80 font-bold text-3xl flex">
      <i class="fa-solid fa-users mr-2"></i>
      <h1>Student Records</h1>
    </div>
    <div class="flex justify-end">
      <button
        class="text-white bg-blue-700/80 ml-auto border border-slate-300 rounded-md p-3 cursor-pointer"
        (click)="navigateToAddStudent()"
      >
        <i class="fa-solid fa-plus"></i>
        Add Course
      </button>

      <button
        type="button"
        (click)="loadStudents()"
        class="bg-blue-700/80 text-white text-[14px] p-3 border rounded-md"
      >
        <i class="fa-solid fa-rotate mr-2"></i>
        Refresh
      </button>
    </div>
  </div>

  <hr class="w-full text-slate-300 shadow-md border-[0.5px] my-6">

  <!-- Table -->
  <table class="w-full border-collapse">
    <thead class="table-header">
      <tr>
        <th class="table-cell">ID</th>
        <th class="table-cell">Name</th>
        <th class="table-cell">Email</th>
        <th class="table-cell">Course</th>
        <th class="table-cell">Grade</th>
        <th class="table-cell">Status</th>
        <th class="table-cell">Actions</th>
      </tr>
    </thead>

    <tbody *ngIf="students$ | async as students; else loading">
      <ng-container *ngFor="let s of students">

        <!-- MAIN ROW -->
        <tr class="border-b border-slate-300">
          <td class="py-4 pl-4">{{ s.student_id }}</td>
          <td class="py-4 pl-8">{{ s.student_name }}</td>
          <td class="py-4 pl-8">{{ s.student_email }}</td>
          <td class="py-4 pl-8">{{ s.courses }}</td>
          <td class="py-4 pl-8">{{ s.grade_numeric || '-' }}</td>

          <td class="py-4 pl-8">
            <div
              class="rounded-[15px] text-[14px] px-3 py-1 text-center"
              [ngClass]="{
                'bg-red-400/20 text-red-950/80':
                  s.student_status === 'Inactive',
                'bg-green-400/20 text-green-950/80':
                  s.student_status === 'Active' ||
                  s.student_status === 'Graduated'
              }"
            >
              {{ s.student_status }}
            </div>
          </td>

          <td class="flex items-center justify-center gap-2 px-4 py-4">
            <button
              class="bg-cyan-500/80 w-[80px] p-2 text-white rounded-md"
              (click)="toggleView(s.student_id)"
            >
              <i class="fa-solid fa-eye"></i> View
            </button>

            <button
              class="bg-orange-400 w-[80px] p-2 text-white rounded-md"
              (click)="editStudent(s.student_id)"
            >
              <i class="fa-solid fa-pen-to-square"></i> Edit
            </button>

            <button
              class="bg-red-600/80 w-[90px] p-2 text-white rounded-md"
              (click)="deleteStudent(s.student_id)"
            >
              <i class="fa-solid fa-trash"></i> Delete
            </button>
          </td>
        </tr>

        <!-- EXPANDED ROW -->
        <tr *ngIf="isExpanded(s.student_id)">
          <td colspan="7" class="bg-slate-100 px-8 py-6">
            <div class="space-y-2 text-[14px]">

              <p>
                <b>Phone:</b>
                {{ studentDetailsMap[s.student_id]?.phone || '—' }}
              </p>

              <p>
                <b>Date of Birth:</b>
                {{ studentDetailsMap[s.student_id]?.date_of_birth || '—' }}
              </p>

              <p>
                <b>Address:</b>
                {{ studentDetailsMap[s.student_id]?.address || '—' }}
              </p>

              <div>
                <b>Courses Opted:</b>
                <ul class="list-disc ml-6 mt-1">
                  <li
                    *ngFor="let c of studentDetailsMap[s.student_id]?.courses"
                  >
                    {{ c.course_name }}
                  </li>
                </ul>
              </div>

            </div>
          </td>
        </tr>

      </ng-container>
    </tbody>
  </table>
</div>

<ng-template #loading>
  <tr>
    <td colspan="7" class="text-center text-slate-500 py-10">
      Loading students...
    </td>
  </tr>
</ng-template>
